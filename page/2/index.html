<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>습관적 프로그래밍</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="습관적 프로그래밍"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="습관적 프로그래밍"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="습관적 프로그래밍"><meta property="og:url" content="http://crazythink.github.io/"><meta property="og:site_name" content="습관적 프로그래밍"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="http://crazythink.github.io/img/og_image.png"><meta property="article:author" content="Daeyoung Kim"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://crazythink.github.io"},"headline":"습관적 프로그래밍","image":["http://crazythink.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Daeyoung Kim"},"publisher":{"@type":"Organization","name":"습관적 프로그래밍","logo":{"@type":"ImageObject","url":"http://crazythink.github.io/img/logo.png"}},"description":null}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="습관적 프로그래밍" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/crazythink"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-09-28T09:00:00.000Z" title="2018. 9. 28. 오후 6:00:00">2018-09-28</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/C/">C++</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/28/LRU/">Least Recently Used</a></h1><div class="content"><h2 id="구현"><a href="#구현" class="headerlink" title="구현"></a>구현</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	list&lt;<span class="keyword">int</span>&gt; cache;</span><br><span class="line">	<span class="keyword">int</span> item;</span><br><span class="line">	<span class="keyword">int</span> cacheSize = <span class="number">3</span>;	<span class="comment">//Cache Size</span></span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;		<span class="comment">//Cache Miss 횟수</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">		cin &gt;&gt; item;</span><br><span class="line">		<span class="keyword">if</span>(cin.<span class="built_in">fail</span>()) <span class="keyword">break</span>;</span><br><span class="line">		cache.<span class="built_in">remove</span>(item);</span><br><span class="line">		<span class="keyword">if</span>(cache.<span class="built_in">size</span>() &lt; cacheSize) cache.<span class="built_in">push_back</span>(item);</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			cout &lt;&lt; cache.<span class="built_in">front</span>() &lt;&lt; endl;	<span class="comment">//교체가 일어난 item 출력</span></span><br><span class="line">			cache.<span class="built_in">pop_front</span>();</span><br><span class="line">			cache.<span class="built_in">push_back</span>(item);</span><br><span class="line">			cache++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(count == <span class="number">0</span>) cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl;		<span class="comment">//Cache Miss가 0이면 0 출력</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-09-28T08:00:00.000Z" title="2018. 9. 28. 오후 5:00:00">2018-09-28</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/C/">C++</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/28/ListContainer/">ListContainer</a></h1><div class="content"><h2 id="list의-사용"><a href="#list의-사용" class="headerlink" title="list의 사용"></a>list의 사용</h2><p><code>#include&lt;list&gt;</code><br><code>list&lt;[Data Type]&gt; [변수 이름];</code></p>
<ul>
<li>예시) <code>list&lt;int&gt; lt1;</code> <code>list&lt;string&gt; lt2;</code></li>
</ul>
<h2 id="list-반복자"><a href="#list-반복자" class="headerlink" title="list 반복자"></a>list 반복자</h2><p><code>list&lt;[Data Type]&gt;::iterator [변수 이름];</code></p>
<h2 id="list-생성자"><a href="#list-생성자" class="headerlink" title="list 생성자"></a>list 생성자</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">list lt;		<span class="comment">//비어있는 list컨테이너 lt를 생성합니다.</span></span><br><span class="line"></span><br><span class="line"><span class="function">list <span class="title">lt</span><span class="params">(<span class="number">10</span>)</span></span>;	<span class="comment">//default(0)값으로 초기화 된 원소 10개를 가진 list를 생성합니다.</span></span><br><span class="line"></span><br><span class="line"><span class="function">list <span class="title">lt</span><span class="params">(<span class="number">3</span>, <span class="number">2</span>)</span></span>;	<span class="comment">//2값으로 초기화 된 원소 3개를 가진 list를 생성합니다.</span></span><br><span class="line"></span><br><span class="line"><span class="function">list <span class="title">lt2</span><span class="params">(lt1)</span></span>;	<span class="comment">//list lt1을 lt2로 복사합니다.</span></span><br></pre></td></tr></table></figure>

<h2 id="list의-멤버-함수"><a href="#list의-멤버-함수" class="headerlink" title="list의 멤버 함수"></a>list의 멤버 함수</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">lt.<span class="built_in">assign</span>(<span class="number">3</span>, <span class="number">4</span>);	<span class="comment">//4로 초기화된 3개의 원소를 할당한다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">front</span>();			<span class="comment">//맨 앞의 원소를 반환(return), 참조 합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">back</span>();			<span class="comment">//맨 뒤의 원소를 반환(return), 참조 합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">begin</span>();			<span class="comment">//맨 앞의 원소를 가리키는 iterator를 반환합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">end</span>();			<span class="comment">//맨 마지막의 다음 원소를 가리키는 iterator를 반환합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">rbegin</span>();		<span class="comment">//뒤에서부터 원소를 순차적으로 접근할때 편리하게 쓰입니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">rend</span>();			<span class="comment">//뒤에서부터 원소를 순차적으로 접근할때 편리하게 쓰입니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">push_back</span>(k);	<span class="comment">//뒤쪽으로 원소 k 를 삽입합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">push_front</span>(k);	<span class="comment">//앞쪽으로 원소 k 를 삽입합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">pop_back</span>();		<span class="comment">//맨 마지막 원소를 제거합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">pop_front</span>();		<span class="comment">//맨 첫번째 원소를 제거합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">insert</span>(iter, k);	<span class="comment">//iter가 가리키는 위치에 원소 k를 삽입합니다. 삽입한 원소를 가리키는 iterator를 </span></span><br><span class="line">반환합니다.</span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">erase</span>(iter);		<span class="comment">//iterator가 가리키는 원소를 삭제합니다.반환값은 삭제한 원소의 다음 원소를 가리키는 iterator를 반환합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">size</span>();			<span class="comment">//원소의 개수를 반환합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">remove</span>(k);		<span class="comment">//k와 같은 원소를 모두 제거합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">remove_if</span>(Predicate);	<span class="comment">//단항 조건자 predicate에 해당하는 원소를 모두 제거합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">predicate</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num&gt;=<span class="number">100</span> &amp;&amp; num&lt;=<span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">reverse</span>();		<span class="comment">//원소들의 순차열을 뒤집습니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">sort</span>();			<span class="comment">//모든 원소를 default(오름차순)으로 정렬합니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">sort</span>(greater&lt;[Data Type]&gt;());	<span class="comment">//모든 원소를 내림차순으로 정렬합니다.</span></span><br><span class="line"></span><br><span class="line">lt2.<span class="built_in">swap</span>(lt1);		<span class="comment">//lt2와 lt1을 swap(바꿉)니다.</span></span><br><span class="line"></span><br><span class="line">lt2.<span class="built_in">splice</span>(iter2, lt1);	<span class="comment">//lt2에서 iter2이 가리키는 곳에 lt1의 모든 원소를 잘라 붙입니다.</span></span><br><span class="line"></span><br><span class="line">lt2.<span class="built_in">splice</span>(iter2, lt1, iter1);	<span class="comment">//lt2의 iter2가 가리키는 곳에 lt1의 iter1이 가리키는 원소를 잘라 붙입</span></span><br><span class="line">니다.</span><br><span class="line"></span><br><span class="line">lt2.<span class="built_in">splice</span>(iter2, lt1, iter1_1, iter1_2);	<span class="comment">// lt2의 iter2가 가리키는 곳에 lt1의 [iter1_1 , iter1_2) 까지의 원소를 잘라 붙입니다.</span></span><br><span class="line"></span><br><span class="line">lt.<span class="built_in">unique</span>();		<span class="comment">//인접한(양옆의) 원소가 같으면 유일하게 만듭니다.(하나만빼고 삭제)</span></span><br><span class="line"></span><br><span class="line">lt2.<span class="built_in">merge</span>(lt1);</span><br><span class="line"><span class="comment">//lt1을 lt2내부로 합병 정렬합니다. 기준은 default 오름차순 입니다. </span></span><br><span class="line"><span class="comment">//두번째 파라미터로 이항 조건자가 올 수 있습니다. 그때는 그 기준으로 정렬합니다.</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-24T19:15:34.000Z" title="2018. 6. 25. 오전 4:15:34">2018-06-25</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/C/">C++</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/25/constexpr/">constexpr</a></h1><div class="content"><h2 id="constexpr"><a href="#constexpr" class="headerlink" title="constexpr"></a>constexpr</h2><p><code>constexpr</code>은 C++11부터 지원하며, Visual Studio 2015부터 사용할 수 있다.</p>
<p>이번에 프로젝트 시연을 하는데, 내 개발환경은 2015 였고, 실습실은 2012 라서 시연을 못했다.</p>
<p>실행파일이라도 가져갔어야 했는데 멍청했다.</p>
<p>그리고 난 망했다..ㅜㅜ</p>
<p>사용법은 <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/ko-kr/library/dn956974.aspx">여기</a>를 참고하자.</p>
<p>그리고 <a target="_blank" rel="noopener" href="https://msdn.microsoft.com/ko-kr/library/hh567368.aspx">호환성</a> 부분도 살펴보자.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-21T07:00:00.000Z" title="2018. 6. 21. 오후 4:00:00">2018-06-21</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Projects/">Projects</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/21/P-CUDA/">(개인 프로젝트) CUDA를 이용해서 멀티 스레드로 작동하는 Image Filter 프로그램</a></h1><div class="content"><h2 id="소개"><a href="#소개" class="headerlink" title="소개"></a>소개</h2><ul>
<li>인원 : 1인</li>
<li>담당 : 프로그램 구현 전체</li>
<li>개발 환경 : Visual Studio 2015, CUDA 9.0</li>
<li>문제<ul>
<li>Input<ul>
<li>Data : 비트맵 이미지의 R, G, B 값</li>
<li>화면 입력 : 불러올 이미지 파일 이름, 적용 필터 </li>
</ul>
</li>
<li>Output<ul>
<li>화면 출력 : 필터 적용에 걸린 시간, 저장된 파일 이름</li>
<li>파일 출력 : 필터가 적용된 이미지</li>
</ul>
</li>
</ul>
</li>
<li>소스코드 : <a target="_blank" rel="noopener" href="https://github.com/CrazyThink/Project/blob/master/CUDA/CUDA/main.cu">CUDA를 이용해서 멀티 스레드로 작동하는 Image Filter 프로그램</a></li>
</ul>
<h2 id="내용"><a href="#내용" class="headerlink" title="내용"></a>내용</h2><p><strong>1. 전부 다 늘릴 때와 각각을 늘릴 때의 차이</strong><br><img src="https://user-images.githubusercontent.com/20267962/44851170-6c7ef200-ac9a-11e8-9b9e-386dc748f37f.png"><br>두 필터는 RGB에 일정 비율을 곱했다는 공통점이 있습니다. 이 중에 밝기 필터는 단순하게 모든 픽셀의 RGB값을 일정 비율만큼 더하면 되지만, 저희가 만든 필터는 채도를 올리는 방식이라서 붉은 계열 색상이라면 더 붉게 만들고, 푸른 계열 색상이라면 더 푸르게 만들어야 합니다.</p>
<p><strong>2. 적용 방법</strong><br><img src="https://user-images.githubusercontent.com/20267962/44851172-6db01f00-ac9a-11e8-9756-b6b647e3f0c4.png"><br>RGB 값을 비교하고, 가장 많이 쓰인 색을 높이는 방식으로 필터를 구현했습니다.</p>
<p><strong>3. 병렬화 부분</strong><br><img src="https://user-images.githubusercontent.com/20267962/44851174-6f79e280-ac9a-11e8-8308-6d1440d70294.png"><br>그리드와 블록은 단순하게 설계하였습니다, 먼저 총 픽셀 수를 구하고, 블록 당 스레드 수를 지정하게 됩니다. 그리고 각 스레드는 한 픽셀 씩 맡아서 RGB값을 처리하게 됩니다. 이렇게 스레드가 한 픽셀을 맡게 되면 동기화 문제는 해결됩니다.</p>
<p><strong>5. 결과 분석 (Intel i7-7700 &amp; GTX 1070 기준)</strong><br><img src="https://user-images.githubusercontent.com/20267962/44851177-70ab0f80-ac9a-11e8-84bc-5f76ddb247f4.png" alt="실행화면"><br><img src="https://user-images.githubusercontent.com/20267962/44851182-71dc3c80-ac9a-11e8-9244-ee3ecaf76168.png" alt="실행결과"><br><img src="https://user-images.githubusercontent.com/20267962/44851184-730d6980-ac9a-11e8-9190-8cf6d4615817.png" alt="결과차트"><br>각 필터 마다 CPU 시간을 GPU 시간으로 나누어서 계산한 차트입니다.<br>평균적으로 10배 이상의 성능 향상을 보이고, 그레이 필터는 다른 필터보다 더 빠른 23배 정도의 성능향상이 있었습니다.<br>아무래도 CPU나 GPU 둘 다 높은 성능 이라서 큰 차이가 보이지 않는 것 같습니다.</p>
<h2 id="어려웠던-점"><a href="#어려웠던-점" class="headerlink" title="어려웠던 점"></a>어려웠던 점</h2><p><img src="https://user-images.githubusercontent.com/20267962/44851591-cb913680-ac9b-11e8-84e7-326be95f61aa.png"><br>무작정 큰 값만 늘리다보니 문제가 발생했습니다. 이 주변은 하늘이라서 주로 파란색 값이 크지만, 이 부분은 구름과 겹쳐서 파란색보다 녹색이 더 많았습니다. 그래서 이 픽셀만 녹색이 더 증가하는 문제가 생기게 된다는 사실을 알았습니다.<br><img src="https://user-images.githubusercontent.com/20267962/44853579-46108500-aca1-11e8-8d3e-7ff889dad4e1.png"><br>이 문제를 해결하기 위해 허용 범위를 지정하였습니다. RGB 값의 차이가 일정 범위 이내라면 비슷한 값들을 한 번에 증가시켰습니다. 이렇게 증가시켰더니 이전 사진에서 구름 일부가 녹색으로 바뀌던 문제를 해결할 수 있었습니다.</p>
<h2 id="배운-점"><a href="#배운-점" class="headerlink" title="배운 점"></a>배운 점</h2><p>이전에 OpenMP만 사용할 때에는 CPU만 사용했기 때문에 스레드가 많아야 겨우 8개 정도였지만, 이번에는 그래픽 카드를 이용했기 때문에 훨씬 많은 수의 스레드를 생성하고 제어하였습니다. 이 프로젝트에서는 사진 파일이 가진 픽셀 수 만큼 스레드를 생성하였는데, 1024 X 1024의 사이즈를 가진 사진이라면 100만개 이상의 스레드를 생성하게 됩니다. 너무 많은 수의 스레드를 생성하다보니 이를 제어하는 것이 처음에는 어려웠지만, 점점 익숙해져서 잘 다룰 수 있게 되었습니다.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-03T04:14:26.000Z" title="2018. 6. 3. 오후 1:14:26">2018-06-03</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/03/ftp/">Linux에 C로 FTP Server와 Client 작성하기</a></h1><div class="content"><h2 id="FTP-Server"><a href="#FTP-Server" class="headerlink" title="FTP Server"></a>FTP Server</h2><h4 id="컴파일-및-실행-방법"><a href="#컴파일-및-실행-방법" class="headerlink" title="컴파일 및 실행 방법"></a>컴파일 및 실행 방법</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o server server.c</span><br><span class="line">$ ./server 9999</span><br></pre></td></tr></table></figure>

<h4 id="server-c"><a href="#server-c" class="headerlink" title="server.c"></a>server.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sendfile.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_listen</span><span class="params">(<span class="keyword">int</span> host, <span class="keyword">int</span> port, <span class="keyword">int</span> backlog)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sd;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line"></span><br><span class="line">	sd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sd == <span class="number">-1</span>) &#123;</span><br><span class="line">		perror(<span class="string">&quot;socket fail&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// servaddr 구조체의 내용 세팅</span></span><br><span class="line">	bzero((<span class="keyword">char</span> *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">	servaddr.sin_family = AF_INET;</span><br><span class="line">	servaddr.sin_addr.s_addr = htonl(host);</span><br><span class="line">	servaddr.sin_port = htons(port);</span><br><span class="line">	<span class="keyword">if</span> (bind(sd, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		perror(<span class="string">&quot;bind fail&quot;</span>);  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 클라이언트로부터 연결요청을 기다림</span></span><br><span class="line">	listen(sd, backlog);</span><br><span class="line">	<span class="keyword">return</span> sd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>, <span class="title">client</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">obj</span>;</span></span><br><span class="line">	<span class="keyword">int</span> sock1, sock2;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">100</span>], command[<span class="number">5</span>], filename[<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">int</span> k, i, size, len, c;</span><br><span class="line">	<span class="keyword">int</span> filehandle;</span><br><span class="line"></span><br><span class="line">	sock1 = tcp_listen(INADDR_ANY, atoi(argv[<span class="number">1</span>]), <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">	len = <span class="keyword">sizeof</span>(client);</span><br><span class="line">	sock2 = accept(sock1, (struct sockaddr*)&amp;client, &amp;len);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		recv(sock2, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">sscanf</span>(buf, <span class="string">&quot;%s&quot;</span>, command);</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;ls&quot;</span>)) &#123;<span class="comment">//ls명령어를 입력받았다면</span></span><br><span class="line">			system(<span class="string">&quot;ls &gt;temps.txt&quot;</span>);</span><br><span class="line">			stat(<span class="string">&quot;temps.txt&quot;</span>, &amp;obj);</span><br><span class="line">			size = obj.st_size;</span><br><span class="line">			send(sock2, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			filehandle = open(<span class="string">&quot;temps.txt&quot;</span>, O_RDONLY);</span><br><span class="line">			sendfile(sock2, filehandle, <span class="literal">NULL</span>, size);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;get&quot;</span>)) &#123;<span class="comment">//get명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">sscanf</span>(buf, <span class="string">&quot;%s%s&quot;</span>, filename, filename);</span><br><span class="line">			stat(filename, &amp;obj);</span><br><span class="line">			filehandle = open(filename, O_RDONLY);</span><br><span class="line">			size = obj.st_size;</span><br><span class="line">			<span class="keyword">if</span> (filehandle == <span class="number">-1</span>)</span><br><span class="line">				size = <span class="number">0</span>;</span><br><span class="line">			send(sock2, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (size)</span><br><span class="line">				sendfile(sock2, filehandle, <span class="literal">NULL</span>, size);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;put&quot;</span>)) &#123;<span class="comment">//put명령어를 입력받았다면</span></span><br><span class="line">			<span class="keyword">int</span> c = <span class="number">0</span>, len;</span><br><span class="line">			<span class="keyword">char</span> *f;</span><br><span class="line">			<span class="built_in">sscanf</span>(buf + <span class="built_in">strlen</span>(command), <span class="string">&quot;%s&quot;</span>, filename);</span><br><span class="line">			recv(sock2, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">				filehandle = open(filename, O_CREAT | O_EXCL | O_WRONLY, <span class="number">0666</span>);</span><br><span class="line">				<span class="keyword">if</span> (filehandle == <span class="number">-1</span>)</span><br><span class="line">					<span class="built_in">sprintf</span>(filename + <span class="built_in">strlen</span>(filename), <span class="string">&quot;_1&quot;</span>);</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			f = <span class="built_in">malloc</span>(size);</span><br><span class="line">			recv(sock2, f, size, <span class="number">0</span>);</span><br><span class="line">			c = write(filehandle, f, size);</span><br><span class="line">			close(filehandle);</span><br><span class="line">			send(sock2, &amp;c, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;pwd&quot;</span>)) &#123;<span class="comment">//pwd명령어를 입력받았다면</span></span><br><span class="line">			system(<span class="string">&quot;pwd&gt;temp.txt&quot;</span>);</span><br><span class="line">			i = <span class="number">0</span>;</span><br><span class="line">			FILE*f = fopen(<span class="string">&quot;temp.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">			<span class="keyword">while</span> (!feof(f)) buf[i++] = fgetc(f);</span><br><span class="line">			buf[i - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			fclose(f);</span><br><span class="line">			send(sock2, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;cd&quot;</span>)) &#123;<span class="comment">//cd명령어를 입력받았다면</span></span><br><span class="line">			<span class="keyword">if</span> (chdir(buf + <span class="number">3</span>) == <span class="number">0</span>) c = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> c = <span class="number">0</span>;	</span><br><span class="line">			send(sock2, &amp;c, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(command, <span class="string">&quot;bye&quot;</span>) || !<span class="built_in">strcmp</span>(command, <span class="string">&quot;quit&quot;</span>)) &#123;</span><br><span class="line">		<span class="comment">//종료 명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;FTP server quitting..\n&quot;</span>);</span><br><span class="line">			i = <span class="number">1</span>;</span><br><span class="line">			send(sock2, &amp;i, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="FTP-Client"><a href="#FTP-Client" class="headerlink" title="FTP Client"></a>FTP Client</h2><h4 id="컴파일-및-실행-방법-1"><a href="#컴파일-및-실행-방법-1" class="headerlink" title="컴파일 및 실행 방법"></a>컴파일 및 실행 방법</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o client client.c</span><br><span class="line">$ ./client 127.0.0.1 9999</span><br></pre></td></tr></table></figure>

<h4 id="client-c"><a href="#client-c" class="headerlink" title="client.c"></a>client.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sendfile.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE  511</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_connect</span><span class="params">(<span class="keyword">int</span> af, <span class="keyword">char</span> *servip, <span class="keyword">unsigned</span> <span class="keyword">short</span> port)</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line">	<span class="keyword">int</span>  s;</span><br><span class="line">	<span class="comment">// 소켓 생성</span></span><br><span class="line">	<span class="keyword">if</span> ((s = socket(af, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="comment">// 채팅 서버의 소켓주소 구조체 servaddr 초기화</span></span><br><span class="line">	bzero((<span class="keyword">char</span> *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">	servaddr.sin_family = af;</span><br><span class="line">	inet_pton(AF_INET, servip, &amp;servaddr.sin_addr);</span><br><span class="line">	servaddr.sin_port = htons(port);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 연결요청</span></span><br><span class="line">	<span class="keyword">if</span> (connect(s, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr))</span><br><span class="line">		&lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">server</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">obj</span>;</span></span><br><span class="line">	<span class="keyword">int</span> sock;</span><br><span class="line">	<span class="keyword">char</span> bufmsg[MAXLINE];</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">100</span>], command[<span class="number">5</span>], filename[MAXLINE], *f;</span><br><span class="line">	<span class="keyword">char</span> temp[<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">int</span> k, size, status;</span><br><span class="line">	<span class="keyword">int</span> filehandle;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;사용법 : %s server_ip port\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sock = tcp_connect(AF_INET, argv[<span class="number">1</span>], atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	<span class="keyword">if</span> (sock == <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;tcp_connect fail&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\033[1;33m명령어 : get, put, pwd, ls, cd, quit\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\033[1;32mclient&gt; &quot;</span>);</span><br><span class="line">		fgets(bufmsg, MAXLINE, <span class="built_in">stdin</span>); <span class="comment">//명령어 입력</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[97m&quot;</span>);   <span class="comment">//글자색을 흰색으로 변경</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;get\n&quot;</span>)) &#123;<span class="comment">//get명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;다운로드할 파일 : &quot;</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, filename);       <span class="comment">//파일 이름 입력</span></span><br><span class="line">			fgets(temp, MAXLINE, <span class="built_in">stdin</span>); <span class="comment">//버퍼에 남은 엔터 제거</span></span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;get &quot;</span>);</span><br><span class="line">			<span class="built_in">strcat</span>(buf, filename);</span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);         <span class="comment">//명령어 전송</span></span><br><span class="line">			recv(sock, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (!size) &#123;<span class="comment">//파일이 없다면</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;파일이 없습니다\n&quot;</span>);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			f = <span class="built_in">malloc</span>(size);</span><br><span class="line">			recv(sock, f, size, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">				filehandle = open(filename, O_CREAT | O_EXCL | O_WRONLY, <span class="number">0666</span>);</span><br><span class="line">				<span class="keyword">if</span> (filehandle == <span class="number">-1</span>) <span class="comment">//같은 이름이 있다면 이름 끝에 _1 추가</span></span><br><span class="line">					<span class="built_in">sprintf</span>(filename + <span class="built_in">strlen</span>(filename), <span class="string">&quot;_1&quot;</span>);</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			write(filehandle, f, size, <span class="number">0</span>);</span><br><span class="line">			close(filehandle);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;다운로드 완료\n&quot;</span>);<span class="comment">//전송이 잘 되었다면</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;put\n&quot;</span>)) &#123;<span class="comment">//put명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;업로드할 파일 : &quot;</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, filename);       <span class="comment">//파일 이름 입력</span></span><br><span class="line">			fgets(temp, MAXLINE, <span class="built_in">stdin</span>); <span class="comment">//버퍼에 남은 엔터 제거</span></span><br><span class="line">			filehandle = open(filename, O_RDONLY);</span><br><span class="line">			<span class="keyword">if</span> (filehandle == <span class="number">-1</span>) &#123;<span class="comment">//파일이 없다면</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;파일이 없습니다.\n&quot;</span>);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;put &quot;</span>);</span><br><span class="line">			<span class="built_in">strcat</span>(buf, filename);</span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			stat(filename, &amp;obj);</span><br><span class="line">			size = obj.st_size;</span><br><span class="line">			send(sock, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);<span class="comment">//명령어 전송</span></span><br><span class="line">			sendfile(sock, filehandle, <span class="literal">NULL</span>, size);<span class="comment">//파일 전송</span></span><br><span class="line">			recv(sock, &amp;status, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (status)<span class="comment">//업로드가 잘 되었다면</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;업로드 완료\n&quot;</span>);</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;업로드 실패\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;pwd\n&quot;</span>)) &#123;<span class="comment">//pwd명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			recv(sock, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;--The path of the Remote Directory--\n%s&quot;</span>, buf);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;ls\n&quot;</span>)) &#123;<span class="comment">//ls명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;ls&quot;</span>);</span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			recv(sock, &amp;size, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			f = <span class="built_in">malloc</span>(size);</span><br><span class="line">			recv(sock, f, size, <span class="number">0</span>);</span><br><span class="line">			filehandle = creat(<span class="string">&quot;temp.txt&quot;</span>, O_WRONLY);</span><br><span class="line">			write(filehandle, f, size, <span class="number">0</span>);</span><br><span class="line">			close(filehandle);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;--The Remote Directory List--\n&quot;</span>);</span><br><span class="line">			system(<span class="string">&quot;cat temp.txt&quot;</span>);	<span class="comment">//현재 디렉토리의 파일 출력</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;cd\n&quot;</span>)) &#123;<span class="comment">//cd명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;cd &quot;</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;이동할 경로 이름 : &quot;</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buf + <span class="number">3</span>);        <span class="comment">//위치 입력</span></span><br><span class="line">			fgets(temp, MAXLINE, <span class="built_in">stdin</span>); <span class="comment">//버퍼에 남은 엔터 제거</span></span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);     <span class="comment">//명령어 전송</span></span><br><span class="line">			recv(sock, &amp;status, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (status)</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;경로 변경 완료\n&quot;</span>);</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;경로 변경 실패\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;quit\n&quot;</span>)) &#123;<span class="comment">//quit명령어를 입력받았다면</span></span><br><span class="line">			<span class="built_in">strcpy</span>(buf, <span class="string">&quot;quit&quot;</span>);</span><br><span class="line">			send(sock, buf, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			recv(sock, &amp;status, <span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (status) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;서버를 닫는 중..\n&quot;</span>);</span><br><span class="line">				<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;서버 닫기 실패\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-03T00:00:00.000Z" title="2018. 6. 3. 오전 9:00:00">2018-06-03</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Projects/">Projects</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/03/P-FTP/">(개인 프로젝트) 파일 전송 서버와 클라이언트 제작</a></h1><div class="content"><h2 id="소개"><a href="#소개" class="headerlink" title="소개"></a>소개</h2><ul>
<li>인원 : 1인</li>
<li>담당 : 프로그램 구현 전체</li>
<li>개발 환경 : Ubuntu 16.04 LTS, VMware Workstation 14 Player</li>
<li>문제<ul>
<li>파일 전송 서버는 서버에서 실행중이며 클라이언트가 전달해주는 내용을 파일로 저장하고 보내주는 역할을 한다.</li>
<li>파일 전송 클라이언트는 서버에 전송할 파일을 선택하여 전송하고, 서버에서 선택한 파일을 전송받아 저장하는 기능을 수행한다. (get : 다운로드 명령, put : 업로드 명령)</li>
<li>클라이언트는 접속한 디렉토리에 대해서 파일을 업로드, 다운로드 하도록 함.</li>
<li>서버에 전송한 파일을 저장하는 디렉토리는 서버 프로세스가 실행되는 곳으로 함.</li>
<li>다운로드할 수 있는 파일은 전체 디렉토리를 대상으로 가능함.<br> (퍼미션을 고려하여 다운로드 가능한 파일)</li>
<li>text 파일, binary 파일 모두 전송이 가능하도록 함.</li>
</ul>
</li>
<li>소스코드 : <a target="_blank" rel="noopener" href="https://github.com/CrazyThink/Project/tree/master/FTP">Linux에 C로 FTP Server와 Client 작성하기</a></li>
<li>사용법 : <a href="https://crazythink.github.io/2018/06/03/ftp/">Linux에 C로 FTP Server와 Client 작성하기</a></li>
</ul>
<h2 id="내용"><a href="#내용" class="headerlink" title="내용"></a>내용</h2><p>컴퓨터의 수가 부족하여 부득이하게 로컬에서 서버와 클라이언트를 함께 실행하였습니다.</p>
<p><img src="https://user-images.githubusercontent.com/20267962/44671524-b8465700-aa60-11e8-8c97-1db72b2bcf55.png"><br>이 중에 위에 있는 터미널은 서버, 아래에 있는 터미널은 클라이언트 입니다.<br>클라이언트는 6가지의 명령을 사용할 수 있습니다.</p>
<ul>
<li><code>get</code> : 서버에서 파일 다운로드</li>
<li><code>put</code> : 서버로 파일 업로드</li>
<li><code>pwd</code> : 현재 디렉토리 위치</li>
<li><code>ls</code> : 현재 디렉토리의 파일 목록</li>
<li><code>cd</code> : 디렉토리 이동</li>
<li><code>quit</code> : 접속 해제</li>
</ul>
<h2 id="어려웠던-점"><a href="#어려웠던-점" class="headerlink" title="어려웠던 점"></a>어려웠던 점</h2><p>평소에는 터미널에서 고작 문자나 주고받는 소켓프로그래밍을 하였지만, 이번에 파일을 통째로 전송해야해서 처음에 어떻게 구현을 해야할지 막막했습니다. 그래서 다른 사람의 소스코드를 참고해가면서, 파일 사이즈를 먼저 전송하고 그 이후에 파일을 전송하는 방식으로 문제를 해결했습니다.</p>
<h2 id="배운-점"><a href="#배운-점" class="headerlink" title="배운 점"></a>배운 점</h2><p>TCP 부분을 응용해서 구현해야하는 프로젝트였습니다. 처음에는 이 문제를 어떻게 해결해야 할지 고민이 많았지만 하나씩 차근차근 해결해나가다 보니 프로그램이 완성되어 있는 것을 볼 수 있었습니다.<br>기본적인 기능 구현 이외에 사용자 편의성을 높이기 위해서 더욱 직관적인 사용법을 도입하였고, 색을 통한 구분으로 가독성이 뛰어나도록 더욱 깔끔한 출력을 하기 위해서 많은 시간을 투자하였습니다. 이를 통해 사용자는 보다 편리한 사용이 가능하고, 손쉽게 파일을 주고받을 수 있습니다.<br>이렇게 사용자를 배려한 프로그램을 구현하다보니 평소에 습득하지 못했던 지식을 더욱 알아갈 수 있는 계기가 되었고, 실력향상에 많은 도움이 되었던 것 같습니다.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-28T02:17:43.000Z" title="2018. 5. 28. 오전 11:17:43">2018-05-28</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Tools/">Tools</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/28/Typora/">Typora</a></h1><div class="content"><p>이 블로그를 작성할 때에는 Markdown 언어를 사용해야 한다.<br>Markdown 문서를 쉽게 작성할 수 있는 툴로 <a target="_blank" rel="noopener" href="https://typora.io/">Typora</a>가 있다.<br>변환된 모양을 바로 볼 수 있어서 편리하다.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-27T07:37:49.000Z" title="2018. 5. 27. 오후 4:37:49">2018-05-27</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/CUDA/">CUDA</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/27/CUDA-INDEX/">CUDA_INDEX</a></h1><div class="content"><h2 id="1D-grid-of-1D-blocks"><a href="#1D-grid-of-1D-blocks" class="headerlink" title="1D grid of 1D blocks"></a>1D grid of 1D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_1D_1D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blockId.x * blockDim.x + threadIdx.x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1D-grid-of-2D-blocks"><a href="#1D-grid-of-2D-blocks" class="headerlink" title="1D grid of 2D blocks"></a>1D grid of 2D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_1D_2D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blockIdx.x * blockDim.x * blockDim.y</span><br><span class="line">        + threadIdx.y * blockDim.x + threadIdx.x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1D-grid-of-3D-blocks"><a href="#1D-grid-of-3D-blocks" class="headerlink" title="1D grid of 3D blocks"></a>1D grid of 3D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_1D_3D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blockIdx.x * blockDim.x * blockDim.y * blockDim.z</span><br><span class="line">        + threadIdx.z * blockDim.y * blockDim.x</span><br><span class="line">        + threadIdx.y * blockDim.x + threadIdx.x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2D-grid-of-1D-blocks"><a href="#2D-grid-of-1D-blocks" class="headerlink" title="2D grid of 1D blocks"></a>2D grid of 1D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__ <span class="keyword">int</span> <span class="title">getGlobalIdx_2D_1D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.y * gridDim.x + blockIdx.x;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2D-grid-of-2D-blocks"><a href="#2D-grid-of-2D-blocks" class="headerlink" title="2D grid of 2D blocks"></a>2D grid of 2D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_2D_2D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.x + blockIdx.y * gridDim.x;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * (blockDim.x * blockDim.y)</span><br><span class="line">        + (threadIdx.y * blockDim.x) + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2D-grid-of-3D-blocks"><a href="#2D-grid-of-3D-blocks" class="headerlink" title="2D grid of 3D blocks"></a>2D grid of 3D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_2D_3D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.x + blockIdx.y * gridDim.x;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * (blockDim.x * blockDim.y * blockDim.z)</span><br><span class="line">        + (threadIdx.z * (blockDim.x * blockDim.y))</span><br><span class="line">        + (threadIdx.y * blockDim.x) + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3D-grid-of-1D-blocks"><a href="#3D-grid-of-1D-blocks" class="headerlink" title="3D grid of 1D blocks"></a>3D grid of 1D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_3D_1D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.x + blockIdx.y * gridDim.x</span><br><span class="line">        + gridDim.x * gridDim.y * blockIdx.z;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * blockDim.x + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3D-grid-of-2D-blocks"><a href="#3D-grid-of-2D-blocks" class="headerlink" title="3D grid of 2D blocks"></a>3D grid of 2D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_3D_2D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.x + blockIdx.y * gridDim.x</span><br><span class="line">        + gridDim.x * gridDim.y * blockIdx.z;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * (blockDim.x * blockDim.y)</span><br><span class="line">        + (threadIdx.y * blockDim.x) + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3D-grid-of-3D-blocks"><a href="#3D-grid-of-3D-blocks" class="headerlink" title="3D grid of 3D blocks"></a>3D grid of 3D blocks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__device__</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getGlobalIdx_3D_3D</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> blockId = blockIdx.x + blockIdx.y * gridDim.x</span><br><span class="line">        + gridDim.x * gridDim.y * blockIdx.z;</span><br><span class="line">    <span class="keyword">int</span> threadId = blockId * (blockDim.x * blockDim.y * blockDim.z)</span><br><span class="line">        + (threadIdx.z * (blockDim.x * blockDim.y))</span><br><span class="line">        + (threadIdx.y * blockDim.x) + threadIdx.x;</span><br><span class="line">    <span class="keyword">return</span> threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-27T00:00:00.000Z" title="2018. 5. 27. 오전 9:00:00">2018-05-27</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Projects/">Projects</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/27/P-CS188/">(개인 프로젝트) Python을 이용한 팩맨 프로젝트 중 Search와 Multiagent Search 구현</a></h1><div class="content"><h2 id="소개"><a href="#소개" class="headerlink" title="소개"></a>소개</h2><ul>
<li>인원 : 1인</li>
<li>담당 : 프로그램 구현 전체</li>
<li>개발 환경 : Python 2.7</li>
<li>문제 : <a target="_blank" rel="noopener" href="http://ai.berkeley.edu/project_overview.html">CS188</a></li>
<li>소스코드 : <a target="_blank" rel="noopener" href="https://github.com/CrazyThink/Project/tree/master/CS188">Python을 이용한 팩맨 프로젝트 중 Search와 Multiagent Search 구현</a></li>
</ul>
<h2 id="내용"><a href="#내용" class="headerlink" title="내용"></a>내용</h2><p><strong>1. Search</strong><br><img src="https://user-images.githubusercontent.com/20267962/44911016-43289980-ad60-11e8-8603-73e584d988aa.png"><br>위에 보이는 것처럼 미로에서 팩맨이 어떻게 하면 최단거리로 먹이를 찾을 수 있을 지에 대한 것을 구현한 것입니다. 이를 구현하기 위해서 <code>DFS</code>, <code>BFS</code>, <code>UCS</code>, <code>A*</code> 알고리즘을 사용하였고, 각 알고리즘을 서로 비교해보았습니다.</p>
<p><strong>2. Multiagent Search</strong><br><img src="https://user-images.githubusercontent.com/20267962/44911019-4459c680-ad60-11e8-8bbf-93d98ff098ef.png"><br>위에 보이는 것처럼 팩맨은 유령을 피하면서 먹이를 먹는 여러 대상을 고려한 알고리즘을 구현하였습니다. 이를 구현하기 위해서 <code>minimax</code>, <code>Alpha-Beta Pruning</code>, <code>Expectimax</code> 를 사용하였습니다.</p>
<h2 id="어려웠던-점"><a href="#어려웠던-점" class="headerlink" title="어려웠던 점"></a>어려웠던 점</h2><p>인공지능을 공부하면서 파이썬을 처음으로 접하게 되었는데, 평소에 사용하던 언어와 다르게 스크립트 기반의 언어라서 어색했습니다. 그래도 이 프로젝트를 진행한 덕분에 파이썬을 더욱 잘 다룰 수 있게 되었습니다. </p>
<h2 id="배운-점"><a href="#배운-점" class="headerlink" title="배운 점"></a>배운 점</h2><p>이론적으로만 알고 있던 알고리즘들을 직접 구현해보니 상황에 따라 어떤 알고리즘을 사용해야하는 지 장단점을 직접 볼 수 있어서 도움이 많이 되었습니다. 이전에 알고리즘 과목을 수강했을 때에는 단일 대상으로부터의 검색 알고리즘 만을 배웠었지만, 이번에는 여러 대상이 있을 때에도 사용 가능한 검색 알고리즘을 익히게 되어서 더욱 다양한 환경에도 적용할 수 있게 되었습니다.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-25T05:43:10.000Z" title="2018. 5. 25. 오후 2:43:10">2018-05-25</time>&nbsp;게시 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/25/socketchat/">Linux에서 Socket으로 채팅구현하기</a></h1><div class="content"><p>서버를 구동시킨 후 클라이언트를 실행합니다.<br>클라이언트는 2개 이상 실행이 가능하며 단체 대화방 처럼 사용이 가능합니다.<br>서버에서 지원하는 명령어는 아래와 같습니다.<br><code>help</code> <code>num_user</code> <code>num_chat</code> <code>ip_list</code></p>
<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><p>컴파일 및 실행 방법</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o server server.c -lpthread</span><br><span class="line">$ ./server 9999</span><br></pre></td></tr></table></figure>

<p>소스코드</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/file.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE  511</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SOCK 1024 <span class="comment">// 솔라리스의 경우 64</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *EXIT_STRING = <span class="string">&quot;exit&quot;</span>;	<span class="comment">// 클라이언트의 종료요청 문자열</span></span><br><span class="line"><span class="keyword">char</span> *START_STRING = <span class="string">&quot;Connected to chat_server \n&quot;</span>;</span><br><span class="line"><span class="comment">// 클라이언트 환영 메시지</span></span><br><span class="line"><span class="keyword">int</span> maxfdp1;				<span class="comment">// 최대 소켓번호 +1</span></span><br><span class="line"><span class="keyword">int</span> num_user = <span class="number">0</span>;			<span class="comment">// 채팅 참가자 수</span></span><br><span class="line"><span class="keyword">int</span> num_chat = <span class="number">0</span>;			<span class="comment">// 지금까지 오간 대화의 수</span></span><br><span class="line"><span class="keyword">int</span> clisock_list[MAX_SOCK];		<span class="comment">// 채팅에 참가자 소켓번호 목록</span></span><br><span class="line"><span class="keyword">char</span> ip_list[MAX_SOCK][<span class="number">20</span>];		<span class="comment">//접속한 ip목록</span></span><br><span class="line"><span class="keyword">int</span> listen_sock;			<span class="comment">// 서버의 리슨 소켓</span></span><br><span class="line"></span><br><span class="line">							<span class="comment">// 새로운 채팅 참가자 처리</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addClient</span><span class="params">(<span class="keyword">int</span> s, struct sockaddr_in *newcliaddr)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmax</span><span class="params">()</span></span>;				<span class="comment">// 최대 소켓 번호 찾기</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeClient</span><span class="params">(<span class="keyword">int</span> s)</span></span>;	<span class="comment">// 채팅 탈퇴 처리 함수</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_listen</span><span class="params">(<span class="keyword">int</span> host, <span class="keyword">int</span> port, <span class="keyword">int</span> backlog)</span></span>; <span class="comment">// 소켓 생성 및 listen</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">errquit</span><span class="params">(<span class="keyword">char</span> *mesg)</span> </span>&#123; perror(mesg); <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">time_t</span> ct;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">tm</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thread_function</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123; <span class="comment">//명령어를 처리할 스레드</span></span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;명령어 목록 : help, num_user, num_chat, ip_list\n&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">char</span> bufmsg[MAXLINE + <span class="number">1</span>];</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[1;32m&quot;</span>); <span class="comment">//글자색을 녹색으로 변경</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;server&gt;&quot;</span>); <span class="comment">//커서 출력</span></span><br><span class="line">		fgets(bufmsg, MAXLINE, <span class="built_in">stdin</span>); <span class="comment">//명령어 입력</span></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;\n&quot;</span>)) <span class="keyword">continue</span>;   <span class="comment">//엔터 무시</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;help\n&quot;</span>))    <span class="comment">//명령어 처리</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;help, num_user, num_chat, ip_list\n&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;num_user\n&quot;</span>))<span class="comment">//명령어 처리</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;현재 참가자 수 = %d\n&quot;</span>, num_user);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;num_chat\n&quot;</span>))<span class="comment">//명령어 처리</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;지금까지 오간 대화의 수 = %d\n&quot;</span>, num_chat);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(bufmsg, <span class="string">&quot;ip_list\n&quot;</span>)) <span class="comment">//명령어 처리</span></span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_user; i++)</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, ip_list[i]);</span><br><span class="line">		<span class="keyword">else</span> <span class="comment">//예외 처리</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;해당 명령어가 없습니다.help를 참조하세요.\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">cliaddr</span>;</span></span><br><span class="line">	<span class="keyword">char</span> buf[MAXLINE + <span class="number">1</span>]; <span class="comment">//클라이언트에서 받은 메시지</span></span><br><span class="line">	<span class="keyword">int</span> i, j, nbyte, accp_sock, addrlen = <span class="keyword">sizeof</span>(struct</span><br><span class="line">		sockaddr_in);</span><br><span class="line">	fd_set read_fds;	<span class="comment">//읽기를 감지할 fd_set 구조체</span></span><br><span class="line">	<span class="keyword">pthread_t</span> a_thread;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;사용법 :%s port\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// tcp_listen(host, port, backlog) 함수 호출</span></span><br><span class="line">	listen_sock = tcp_listen(INADDR_ANY, atoi(argv[<span class="number">1</span>]), <span class="number">5</span>);</span><br><span class="line">	<span class="comment">//스레드 생성</span></span><br><span class="line">	pthread_create(&amp;a_thread, <span class="literal">NULL</span>, thread_function, (<span class="keyword">void</span> *)<span class="literal">NULL</span>);</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		FD_ZERO(&amp;read_fds);</span><br><span class="line">		FD_SET(listen_sock, &amp;read_fds);</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_user; i++)</span><br><span class="line">			FD_SET(clisock_list[i], &amp;read_fds);</span><br><span class="line"></span><br><span class="line">		maxfdp1 = getmax() + <span class="number">1</span>;	<span class="comment">// maxfdp1 재 계산</span></span><br><span class="line">		<span class="keyword">if</span> (select(maxfdp1, &amp;read_fds, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">			errquit(<span class="string">&quot;select fail&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET(listen_sock, &amp;read_fds)) &#123;</span><br><span class="line">			accp_sock = accept(listen_sock,</span><br><span class="line">				(struct sockaddr*)&amp;cliaddr, &amp;addrlen);</span><br><span class="line">			<span class="keyword">if</span> (accp_sock == <span class="number">-1</span>) errquit(<span class="string">&quot;accept fail&quot;</span>);</span><br><span class="line">			addClient(accp_sock, &amp;cliaddr);</span><br><span class="line">			send(accp_sock, START_STRING, <span class="built_in">strlen</span>(START_STRING), <span class="number">0</span>);</span><br><span class="line">			ct = time(<span class="literal">NULL</span>);			<span class="comment">//현재 시간을 받아옴</span></span><br><span class="line">			tm = *localtime(&amp;ct);</span><br><span class="line">			write(<span class="number">1</span>, <span class="string">&quot;\033[0G&quot;</span>, <span class="number">4</span>);		<span class="comment">//커서의 X좌표를 0으로 이동</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;[%02d:%02d:%02d]&quot;</span>, tm.tm_hour, tm.tm_min, tm.tm_sec);</span><br><span class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[33m&quot;</span>);<span class="comment">//글자색을 노란색으로 변경</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;사용자 1명 추가. 현재 참가자 수 = %d\n&quot;</span>, num_user);</span><br><span class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[32m&quot;</span>);<span class="comment">//글자색을 녹색으로 변경</span></span><br><span class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;server&gt;&quot;</span>); <span class="comment">//커서 출력</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 클라이언트가 보낸 메시지를 모든 클라이언트에게 방송</span></span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_user; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (FD_ISSET(clisock_list[i], &amp;read_fds)) &#123;</span><br><span class="line">				num_chat++;				<span class="comment">//총 대화 수 증가</span></span><br><span class="line">				nbyte = recv(clisock_list[i], buf, MAXLINE, <span class="number">0</span>);</span><br><span class="line">				<span class="keyword">if</span> (nbyte &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">					removeClient(i);	<span class="comment">// 클라이언트의 종료</span></span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				buf[nbyte] = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">// 종료문자 처리</span></span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">strstr</span>(buf, EXIT_STRING) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">					removeClient(i);	<span class="comment">// 클라이언트의 종료</span></span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// 모든 채팅 참가자에게 메시지 방송</span></span><br><span class="line">				<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; num_user; j++)</span><br><span class="line">					send(clisock_list[j], buf, nbyte, <span class="number">0</span>);</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;\033[0G&quot;</span>);		<span class="comment">//커서의 X좌표를 0으로 이동</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[97m&quot;</span>);<span class="comment">//글자색을 흰색으로 변경</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);			<span class="comment">//메시지 출력</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[32m&quot;</span>);<span class="comment">//글자색을 녹색으로 변경</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;server&gt;&quot;</span>); <span class="comment">//커서 출력</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;  <span class="comment">// end of while</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 새로운 채팅 참가자 처리</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addClient</span><span class="params">(<span class="keyword">int</span> s, struct sockaddr_in *newcliaddr)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">	inet_ntop(AF_INET, &amp;newcliaddr-&gt;sin_addr, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">	write(<span class="number">1</span>, <span class="string">&quot;\033[0G&quot;</span>, <span class="number">4</span>);		<span class="comment">//커서의 X좌표를 0으로 이동</span></span><br><span class="line">	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[33m&quot;</span>);	<span class="comment">//글자색을 노란색으로 변경</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;new client: %s\n&quot;</span>, buf);<span class="comment">//ip출력</span></span><br><span class="line">	<span class="comment">// 채팅 클라이언트 목록에 추가</span></span><br><span class="line">	clisock_list[num_user] = s;</span><br><span class="line">	<span class="built_in">strcpy</span>(ip_list[num_user], buf);</span><br><span class="line">	num_user++; <span class="comment">//유저 수 증가</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 채팅 탈퇴 처리</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeClient</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	close(clisock_list[s]);</span><br><span class="line">	<span class="keyword">if</span> (s != num_user - <span class="number">1</span>) &#123; <span class="comment">//저장된 리스트 재배열</span></span><br><span class="line">		clisock_list[s] = clisock_list[num_user - <span class="number">1</span>];</span><br><span class="line">		<span class="built_in">strcpy</span>(ip_list[s], ip_list[num_user - <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	num_user--; <span class="comment">//유저 수 감소</span></span><br><span class="line">	ct = time(<span class="literal">NULL</span>);			<span class="comment">//현재 시간을 받아옴</span></span><br><span class="line">	tm = *localtime(&amp;ct);</span><br><span class="line">	write(<span class="number">1</span>, <span class="string">&quot;\033[0G&quot;</span>, <span class="number">4</span>);		<span class="comment">//커서의 X좌표를 0으로 이동</span></span><br><span class="line">	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[33m&quot;</span>);<span class="comment">//글자색을 노란색으로 변경</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[%02d:%02d:%02d]&quot;</span>, tm.tm_hour, tm.tm_min, tm.tm_sec);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;채팅 참가자 1명 탈퇴. 현재 참가자 수 = %d\n&quot;</span>, num_user);</span><br><span class="line">	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[32m&quot;</span>);<span class="comment">//글자색을 녹색으로 변경</span></span><br><span class="line">	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;server&gt;&quot;</span>); <span class="comment">//커서 출력</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 최대 소켓번호 찾기</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Minimum 소켓번호는 가정 먼저 생성된 listen_sock</span></span><br><span class="line">	<span class="keyword">int</span> max = listen_sock;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_user; i++)</span><br><span class="line">		<span class="keyword">if</span> (clisock_list[i] &gt; max)</span><br><span class="line">			max = clisock_list[i];</span><br><span class="line">	<span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// listen 소켓 생성 및 listen</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">tcp_listen</span><span class="params">(<span class="keyword">int</span> host, <span class="keyword">int</span> port, <span class="keyword">int</span> backlog)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sd;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line"></span><br><span class="line">	sd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (sd == <span class="number">-1</span>) &#123;</span><br><span class="line">		perror(<span class="string">&quot;socket fail&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// servaddr 구조체의 내용 세팅</span></span><br><span class="line">	bzero((<span class="keyword">char</span> *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">	servaddr.sin_family = AF_INET;</span><br><span class="line">	servaddr.sin_addr.s_addr = htonl(host);</span><br><span class="line">	servaddr.sin_port = htons(port);</span><br><span class="line">	<span class="keyword">if</span> (bind(sd, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		perror(<span class="string">&quot;bind fail&quot;</span>);  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 클라이언트로부터 연결요청을 기다림</span></span><br><span class="line">	listen(sd, backlog);</span><br><span class="line">	<span class="keyword">return</span> sd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><p>컴파일 및 실행 방법</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o client client.c</span><br><span class="line">$ ./client 127.0.0.1 9999 nick</span><br></pre></td></tr></table></figure>

<p>소스코드</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXLINE     1000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME_LEN    20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *EXIT_STRING = <span class="string">&quot;exit&quot;</span>;</span><br><span class="line"><span class="comment">// 소켓 생성 및 서버 연결, 생성된 소켓리턴</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_connect</span><span class="params">(<span class="keyword">int</span> af, <span class="keyword">char</span> *servip, <span class="keyword">unsigned</span> <span class="keyword">short</span> port)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">errquit</span><span class="params">(<span class="keyword">char</span> *mesg)</span> </span>&#123; perror(mesg); <span class="built_in">exit</span>(<span class="number">1</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> bufname[NAME_LEN];	<span class="comment">// 이름</span></span><br><span class="line">	<span class="keyword">char</span> bufmsg[MAXLINE];	<span class="comment">// 메시지부분</span></span><br><span class="line">	<span class="keyword">char</span> bufall[MAXLINE + NAME_LEN];</span><br><span class="line">	<span class="keyword">int</span> maxfdp1;	<span class="comment">// 최대 소켓 디스크립터</span></span><br><span class="line">	<span class="keyword">int</span> s;		<span class="comment">// 소켓</span></span><br><span class="line">	<span class="keyword">int</span> namelen;	<span class="comment">// 이름의 길이</span></span><br><span class="line">	fd_set read_fds;</span><br><span class="line">	<span class="keyword">time_t</span> ct;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tm</span> <span class="title">tm</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;사용법 : %s sever_ip  port name \n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	s = tcp_connect(AF_INET, argv[<span class="number">1</span>], atoi(argv[<span class="number">2</span>]));</span><br><span class="line">	<span class="keyword">if</span> (s == <span class="number">-1</span>)</span><br><span class="line">		errquit(<span class="string">&quot;tcp_connect fail&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;서버에 접속되었습니다.&quot;</span>);</span><br><span class="line">	maxfdp1 = s + <span class="number">1</span>;</span><br><span class="line">	FD_ZERO(&amp;read_fds);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		FD_SET(<span class="number">0</span>, &amp;read_fds);</span><br><span class="line">		FD_SET(s, &amp;read_fds);</span><br><span class="line">		<span class="keyword">if</span> (select(maxfdp1, &amp;read_fds, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</span><br><span class="line">			errquit(<span class="string">&quot;select fail&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET(s, &amp;read_fds)) &#123;</span><br><span class="line">			<span class="keyword">int</span> nbyte;</span><br><span class="line">			<span class="keyword">if</span> ((nbyte = recv(s, bufmsg, MAXLINE, <span class="number">0</span>)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				bufmsg[nbyte] = <span class="number">0</span>;</span><br><span class="line">				write(<span class="number">1</span>, <span class="string">&quot;\033[0G&quot;</span>, <span class="number">4</span>);		<span class="comment">//커서의 X좌표를 0으로 이동</span></span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, bufmsg);		<span class="comment">//메시지 출력</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[1;32m&quot;</span>);	<span class="comment">//글자색을 녹색으로 변경</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;%s&gt;&quot;</span>, argv[<span class="number">3</span>]);<span class="comment">//내 닉네임 출력</span></span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (FD_ISSET(<span class="number">0</span>, &amp;read_fds)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (fgets(bufmsg, MAXLINE, <span class="built_in">stdin</span>)) &#123;</span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[1;33m&quot;</span>); <span class="comment">//글자색을 노란색으로 변경</span></span><br><span class="line">				<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\033[1A&quot;</span>); <span class="comment">//Y좌표를 현재 위치로부터 -1만큼 이동</span></span><br><span class="line">				ct = time(<span class="literal">NULL</span>);	<span class="comment">//현재 시간을 받아옴</span></span><br><span class="line">				tm = *localtime(&amp;ct);</span><br><span class="line">				<span class="built_in">sprintf</span>(bufall, <span class="string">&quot;[%02d:%02d:%02d]%s&gt;%s&quot;</span>, tm.tm_hour, tm.tm_min, tm.tm_sec, argv[<span class="number">3</span>], bufmsg);<span class="comment">//메시지에 현재시간 추가</span></span><br><span class="line">				<span class="keyword">if</span> (send(s, bufall, <span class="built_in">strlen</span>(bufall), <span class="number">0</span>) &lt; <span class="number">0</span>)</span><br><span class="line">					<span class="built_in">puts</span>(<span class="string">&quot;Error : Write error on socket.&quot;</span>);</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">strstr</span>(bufmsg, EXIT_STRING) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">					<span class="built_in">puts</span>(<span class="string">&quot;Good bye.&quot;</span>);</span><br><span class="line">					close(s);</span><br><span class="line">					<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="comment">// end of while</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_connect</span><span class="params">(<span class="keyword">int</span> af, <span class="keyword">char</span> *servip, <span class="keyword">unsigned</span> <span class="keyword">short</span> port)</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></span><br><span class="line">	<span class="keyword">int</span>  s;</span><br><span class="line">	<span class="comment">// 소켓 생성</span></span><br><span class="line">	<span class="keyword">if</span> ((s = socket(af, SOCK_STREAM, <span class="number">0</span>)) &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="comment">// 채팅 서버의 소켓주소 구조체 servaddr 초기화</span></span><br><span class="line">	bzero((<span class="keyword">char</span> *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr));</span><br><span class="line">	servaddr.sin_family = af;</span><br><span class="line">	inet_pton(AF_INET, servip, &amp;servaddr.sin_addr);</span><br><span class="line">	servaddr.sin_port = htons(port);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 연결요청</span></span><br><span class="line">	<span class="keyword">if</span> (connect(s, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr))</span><br><span class="line">		&lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">Previous</a></div><div class="pagination-next"><a href="/page/3/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="Daeyoung Kim"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Daeyoung Kim</p><p class="is-size-6 is-block">Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">28</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">36</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/crazythink" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/crazythink"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="/"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CS188/"><span class="tag">CS188</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CUDA/"><span class="tag">CUDA</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chat/"><span class="tag">Chat</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Database/"><span class="tag">Database</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Diary/"><span class="tag">Diary</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Editor/"><span class="tag">Editor</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FTP/"><span class="tag">FTP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Game/"><span class="tag">Game</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JUnit/"><span class="tag">JUnit</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Javascript/"><span class="tag">Javascript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Messenger/"><span class="tag">Messenger</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NHN/"><span class="tag">NHN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenMP/"><span class="tag">OpenMP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Oracle/"><span class="tag">Oracle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Partitioning/"><span class="tag">Partitioning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STL/"><span class="tag">STL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Secure/"><span class="tag">Secure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Server/"><span class="tag">Server</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Singleton/"><span class="tag">Singleton</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Socket/"><span class="tag">Socket</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tomcat/"><span class="tag">Tomcat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Typora/"><span class="tag">Typora</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unity/"><span class="tag">Unity</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/CUDA/"><span class="level-start"><span class="level-item">CUDA</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Diary/"><span class="level-start"><span class="level-item">Diary</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Javascript/"><span class="level-start"><span class="level-item">Javascript</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Secure/"><span class="level-start"><span class="level-item">Secure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Tomcat/"><span class="level-start"><span class="level-item">Tomcat</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tools/"><span class="level-start"><span class="level-item">Tools</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-12-26T06:40:00.000Z">2021-12-26</time></p><p class="title"><a href="/2021/12/26/S-GameSecure/">당신의 게임은 안전한가요?</a></p><p class="categories"><a href="/categories/Secure/">Secure</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-05-23T13:00:00.000Z">2020-05-23</time></p><p class="title"><a href="/2020/05/23/map-filter-find-reduce/">Javascript Array 가공 map(), filter(), find(), reduce()</a></p><p class="categories"><a href="/categories/Javascript/">Javascript</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-05-23T12:00:00.000Z">2020-05-23</time></p><p class="title"><a href="/2020/05/23/some-every/">Javascript forEach()의 업그레이드 every(), some()</a></p><p class="categories"><a href="/categories/Javascript/">Javascript</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-02-24T12:00:00.000Z">2019-02-24</time></p><p class="title"><a href="/2019/02/24/Partitioning/">파티셔닝</a></p><p class="categories"><a href="/categories/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-02-13T08:00:00.000Z">2019-02-13</time></p><p class="title"><a href="/2019/02/13/Fixture/">Test에서 Fixture란?</a></p><p class="categories"><a href="/categories/Spring/">Spring</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">12월 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">5월 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">2월 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">1월 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">9월 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">5월 2018</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">12월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">6월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">5월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">10월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">11월 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="습관적 프로그래밍" height="28"></a><p class="is-size-7"><span>&copy; 2021 Daeyoung Kim</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko-kr");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="검색어를 입력하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"검색어를 입력하세요...","untitled":"(제목 없음)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>